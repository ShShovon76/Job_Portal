<div class="reviews-container">
  <!-- Company Header -->
  <div class="company-header" *ngIf="company">
    <a [routerLink]="['/companies', company.id]" class="back-link">
      <i class="bi bi-arrow-left"></i> Back to Company
    </a>
    
    <div class="company-info">
      <div class="company-logo-container">
        <img 
          *ngIf="company.logoUrl" 
          [src]="company.logoUrl" 
          [alt]="company.name + ' logo'"
          class="company-logo"
        />
        <div *ngIf="!company.logoUrl" class="company-logo-placeholder">
          {{ company.name.charAt(0) }}
        </div>
      </div>
      
      <div class="company-details">
        <h1 class="company-name">{{ company.name }}</h1>
        <p class="company-industry">{{ company.industry }}</p>
        <div class="company-rating-overview">
          <div class="average-rating">
            <span class="rating-number">{{ averageRating.toFixed(1) }}</span>
            <div class="stars">
              <i 
                *ngFor="let star of getStarIcons(averageRating); let i = index" 
                [class]="'bi ' + star + ' star-icon'"
              ></i>
            </div>
            <span class="rating-count">Based on {{ totalReviews }} review{{ totalReviews !== 1 ? 's' : '' }}</span>
          </div>
          <button 
            class="write-review-btn" 
            (click)="toggleReviewForm()"
            [disabled]="hasUserReviewed"
          >
            <i class="bi bi-pencil-square"></i>
            {{ hasUserReviewed ? 'Already Reviewed' : 'Write a Review' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Form Modal -->
  <div *ngIf="showReviewForm" class="review-form-modal">
    <div class="review-form-container">
      <div class="review-form-header">
        <h3>Write a Review for {{ company?.name }}</h3>
        <button class="close-btn" (click)="toggleReviewForm()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      
      <form [formGroup]="reviewForm" (ngSubmit)="submitReview()">
        <div class="form-group">
          <label>Your Rating *</label>
          <div class="rating-selector">
            <button 
              *ngFor="let rating of [5,4,3,2,1]; let i = index" 
              type="button"
              class="rating-option"
              [class.selected]="reviewForm.value.rating === rating"
              (click)="setRating(rating)"
            >
              <span class="rating-number">{{ rating }}</span>
              <i class="bi bi-star-fill"></i>
              <span class="rating-text">{{ getRatingText(rating) }}</span>
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="reviewTitle">Review Title *</label>
          <input 
            type="text" 
            id="reviewTitle"
            formControlName="title"
            placeholder="Summarize your experience"
            class="form-control"
          />
          <div *ngIf="reviewForm.get('title')?.invalid && reviewForm.get('title')?.touched" class="error-message">
            Title must be 5-100 characters
          </div>
        </div>
        
        <div class="form-group">
          <label for="reviewComment">Your Review *</label>
          <textarea 
            id="reviewComment"
            formControlName="comment"
            rows="5"
            placeholder="Share details of your own experience at this company..."
            class="form-control"
          ></textarea>
          <div class="char-count">
            {{ reviewForm.value.comment?.length || 0 }}/1000
          </div>
          <div *ngIf="reviewForm.get('comment')?.invalid && reviewForm.get('comment')?.touched" class="error-message">
            Review must be 20-1000 characters
          </div>
        </div>
        
        <div class="form-actions">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="toggleReviewForm()"
          >
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn-submit" 
            [disabled]="reviewForm.invalid || submittingReview"
          >
            <span *ngIf="!submittingReview">Submit Review</span>
            <span *ngIf="submittingReview">
              <i class="bi bi-hourglass-split"></i> Submitting...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Main Content -->
  <div class="reviews-content">
    <div class="sidebar">
      <!-- Rating Distribution -->
      <div class="rating-distribution card">
        <h3>Rating Breakdown</h3>
        <div class="distribution-list">
          <div *ngFor="let dist of ratingDistribution" class="distribution-item">
            <span class="rating-label">{{ dist.rating }} star{{ dist.rating !== 1 ? 's' : '' }}</span>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="dist.percentage"></div>
            </div>
            <span class="rating-count">{{ dist.count }} ({{ dist.percentage.toFixed(0) }}%)</span>
          </div>
        </div>
        
        <div class="overall-stats">
          <div class="stat-item">
            <i class="bi bi-people"></i>
            <div>
              <strong>{{ totalReviews }}</strong>
              <span>Total Reviews</span>
            </div>
          </div>
          <div class="stat-item">
            <i class="bi bi-star-half"></i>
            <div>
              <strong>{{ averageRating.toFixed(1) }}</strong>
              <span>Average Rating</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Review Guidelines -->
      <div class="guidelines card">
        <h3>Review Guidelines</h3>
        <ul>
          <li><i class="bi bi-check-circle"></i> Be specific and detailed</li>
          <li><i class="bi bi-check-circle"></i> Share genuine experiences</li>
          <li><i class="bi bi-check-circle"></i> Respectful and professional</li>
          <li><i class="bi bi-check-circle"></i> No personal attacks</li>
        </ul>
      </div>
    </div>
    
    <!-- Reviews List -->
    <div class="reviews-list">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading reviews...</p>
      </div>
      
      <!-- No Reviews State -->
      <div *ngIf="!loading && reviews.length === 0" class="no-reviews">
        <i class="bi bi-chat-square-text"></i>
        <h3>No reviews yet</h3>
        <p>Be the first to share your experience with {{ company?.name }}</p>
        <button class="btn-primary" (click)="toggleReviewForm()" [disabled]="!currentUser">
          <i class="bi bi-pencil-square"></i>
          Write First Review
        </button>
      </div>
      
      <!-- Reviews -->
      <div *ngFor="let review of reviews" class="review-card">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">
              {{ getReviewerInitials('Anonymous') }}
            </div>
            <div class="reviewer-details">
              <h4 class="reviewer-name">Anonymous</h4>
              <div class="review-meta">
                <span class="review-date">{{ getTimeAgo(review.createdAt) }}</span>
                <span class="separator">â€¢</span>
                <span class="reviewer-verified" *ngIf="review.createdAt">
                  <i class="bi bi-patch-check-fill"></i> Verified Review
                </span>
              </div>
            </div>
          </div>
          
          <div class="review-rating">
            <div class="stars">
              <i 
                *ngFor="let star of getStarIcons(review.rating); let i = index" 
                [class]="'bi ' + star + ' star-icon'"
              ></i>
            </div>
            <span class="rating-text">{{ getRatingText(review.rating) }}</span>
          </div>
        </div>
        
        <div class="review-content">
          <h5 class="review-title">{{ review.title }}</h5>
          <p class="review-comment">{{ review.comment }}</p>
        </div>
        
        <div class="review-footer">
          <div class="review-helpful">
            <button class="helpful-btn">
              <i class="bi bi-hand-thumbs-up"></i> Helpful
              <span class="count">(0)</span>
            </button>
            <button class="helpful-btn">
              <i class="bi bi-hand-thumbs-down"></i> Not Helpful
              <span class="count">(0)</span>
            </button>
          </div>
          <button class="report-btn" title="Report inappropriate review">
            <i class="bi bi-flag"></i>
          </button>
        </div>
      </div>
      
      <!-- Pagination -->
      <div *ngIf="totalReviews > itemsPerPage" class="pagination">
        <button 
          class="page-btn" 
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)"
        >
          <i class="bi bi-chevron-left"></i> Previous
        </button>
        
        <div class="page-numbers">
          <span *ngFor="let page of getPageNumbers()" 
                [class.active]="page === currentPage"
                [class.disabled]="page === '...'"
                (click)="page !== '...' && onPageChange(page)"
                class="page-number">
            {{ page }}
          </span>
        </div>
        
        <button 
          class="page-btn" 
          [disabled]="currentPage * itemsPerPage >= totalReviews"
          (click)="onPageChange(currentPage + 1)"
        >
          Next <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>
