<div class="auth-container">
    <div class="auth-card">
        <!-- Header -->
        <div class="auth-header text-center mb-5">
            <div class="logo mb-4">
                <i class="bi bi-briefcase-fill text-primary fs-1"></i>
                <h2 class="mt-3 fw-bold">JobPortal</h2>
            </div>
            <h3 class="fw-bold">Create Your Account</h3>
            <p class="text-muted">Choose your account type to get started</p>
        </div>

        <!-- Alert Messages -->
        <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ errorMessage }}
            <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="Close"></button>
        </div>

        <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            {{ successMessage }}
        </div>

        <!-- Role Selection -->
        <div *ngIf="!selectedRole" class="role-selection">
            <div class="row g-4">
                <!-- Job Seeker Card -->
                <div class="col-md-6">
                    <div class="role-card" (click)="selectRole(UserRole.JOB_SEEKER)">
                        <div class="role-icon mb-3">
                            <i class="bi bi-person-badge fs-1"></i>
                        </div>
                        <h4 class="role-title">Job Seeker</h4>
                        <p class="role-description text-muted">
                            Looking for your dream job? Create a profile and start applying to opportunities.
                        </p>
                        <ul class="role-features">
                            <li><i class="bi bi-check-circle-fill text-success me-2"></i>Upload resume</li>
                            <li><i class="bi bi-check-circle-fill text-success me-2"></i>Apply to jobs</li>
                            <li><i class="bi bi-check-circle-fill text-success me-2"></i>Get job alerts</li>
                        </ul>
                        <button class="btn btn-outline-primary w-100 mt-3">
                            Select as Job Seeker
                        </button>
                    </div>
                </div>

                <!-- Employer Card -->
                <div class="col-md-6">
                    <div class="role-card" (click)="selectRole(UserRole.EMPLOYER)">
                        <div class="role-icon mb-3">
                            <i class="bi bi-building fs-1"></i>
                        </div>
                        <h4 class="role-title">Employer</h4>
                        <p class="role-description text-muted">
                            Looking for talent? Post jobs and find qualified candidates for your company.
                        </p>
                        <ul class="role-features">
                            <li><i class="bi bi-check-circle-fill text-success me-2"></i>Post job listings</li>
                            <li><i class="bi bi-check-circle-fill text-success me-2"></i>Manage applicants</li>
                            <li><i class="bi bi-check-circle-fill text-success me-2"></i>Company profile</li>
                        </ul>
                        <button class="btn btn-outline-primary w-100 mt-3">
                            Select as Employer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Already have account -->
            <div class="text-center mt-5">
                <p class="text-muted">
                    Already have an account?
                    <a (click)="navigateToLogin()"
                        class="text-decoration-none fw-medium text-primary ms-1 cursor-pointer">
                        Sign in here
                    </a>
                </p>
            </div>
        </div>

        <!-- Registration Form -->
        <div *ngIf="selectedRole">
            <!-- Back Button -->
            <button (click)="goBack()" class="btn btn-link text-decoration-none p-0 mb-4">
                <i class="bi bi-arrow-left me-1"></i> Back to selection
            </button>

            <!-- Role Badge -->
            <div class="role-badge mb-4">
                <span class="badge" [class.bg-success]="selectedRole === UserRole.JOB_SEEKER"
                    [class.bg-primary]="selectedRole === UserRole.EMPLOYER">
                    <i class="bi me-2" [class.bi-person-badge]="selectedRole === UserRole.JOB_SEEKER"
                        [class.bi-building]="selectedRole === UserRole.EMPLOYER"></i>
                    {{ selectedRole === UserRole.JOB_SEEKER ? 'Job Seeker Registration' : 'Employer Registration' }}
                </span>
            </div>

            <!-- Registration Form -->
            <form [formGroup]="commonForm" (ngSubmit)="onSubmit()" novalidate>
                <!-- Full Name -->
                <div class="mb-3">
                    <label for="fullName" class="form-label fw-medium">Full Name</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">
                            <i class="bi bi-person text-muted"></i>
                        </span>
                        <input type="text" id="fullName" formControlName="fullName" class="form-control"
                            [class.is-invalid]="submitted && fullNameControl.invalid"
                            placeholder="Enter your full name">
                    </div>
                    <div *ngIf="submitted && fullNameControl.invalid" class="invalid-feedback d-block mt-1">
                        <span *ngIf="fullNameControl.errors?.['required']">
                            <i class="bi bi-x-circle me-1"></i>Full name is required
                        </span>
                        <span *ngIf="fullNameControl.errors?.['minlength']">
                            <i class="bi bi-x-circle me-1"></i>Name must be at least 2 characters
                        </span>
                    </div>
                </div>

                <!-- Email -->
                <div class="mb-3">
                    <label for="email" class="form-label fw-medium">Email Address</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">
                            <i class="bi bi-envelope text-muted"></i>
                        </span>
                        <input type="email" id="email" formControlName="email" class="form-control"
                            [class.is-invalid]="submitted && emailControl.invalid" placeholder="Enter your email">
                    </div>
                    <div *ngIf="submitted && emailControl.invalid" class="invalid-feedback d-block mt-1">
                        <span *ngIf="emailControl.errors?.['required']">
                            <i class="bi bi-x-circle me-1"></i>Email is required
                        </span>
                        <span *ngIf="emailControl.errors?.['email']">
                            <i class="bi bi-x-circle me-1"></i>Please enter a valid email
                        </span>
                    </div>
                </div>

                <!-- Password -->
                <div class="mb-3">
                    <label for="password" class="form-label fw-medium">Password</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">
                            <i class="bi bi-lock text-muted"></i>
                        </span>
                        <input [type]="showPassword ? 'text' : 'password'" id="password" formControlName="password"
                            class="form-control" [class.is-invalid]="submitted && passwordControl.invalid"
                            placeholder="Create password">
                        <button class="btn btn-outline-secondary border-start-0" type="button"
                            (click)="togglePasswordVisibility('password')">
                            <i class="bi" [class.bi-eye]="!showPassword" [class.bi-eye-slash]="showPassword"></i>
                        </button>
                    </div>

                    <!-- Password Strength Meter -->
                    <div class="password-strength mt-2" *ngIf="passwordControl.value">
                        <div class="progress" style="height: 5px;">
                            <div class="progress-bar" [ngClass]="getStrengthClass()" [style.width.%]="passwordStrength">
                            </div>
                        </div>
                        <small class="text-muted mt-1 d-block">
                            Strength:
                            <span [ngClass]="{
                'text-danger': passwordStrength < 40,
                'text-warning': passwordStrength >= 40 && passwordStrength < 70,
                'text-success': passwordStrength >= 70
              }">
                                {{ passwordStrength < 40 ? 'Weak' : passwordStrength < 70 ? 'Medium' : 'Strong' }}
                                    </span>
                        </small>
                    </div>

                    <div *ngIf="submitted && passwordControl.invalid" class="invalid-feedback d-block mt-1">
                        <span *ngIf="passwordControl.errors?.['required']">
                            <i class="bi bi-x-circle me-1"></i>Password is required
                        </span>
                        <span *ngIf="passwordControl.errors?.['minlength']">
                            <i class="bi bi-x-circle me-1"></i>Minimum 8 characters required
                        </span>
                        <span *ngIf="passwordControl.errors?.['passwordStrength']">
                            <i class="bi bi-x-circle me-1"></i>Must include uppercase, lowercase, and numbers
                        </span>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label fw-medium">Confirm Password</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">
                            <i class="bi bi-lock-fill text-muted"></i>
                        </span>
                        <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword"
                            formControlName="confirmPassword" class="form-control"
                            [class.is-invalid]="submitted && (confirmPasswordControl.invalid || commonForm.errors?.['passwordMismatch'])"
                            placeholder="Confirm password">
                        <button class="btn btn-outline-secondary border-start-0" type="button"
                            (click)="togglePasswordVisibility('confirm')">
                            <i class="bi" [class.bi-eye]="!showConfirmPassword"
                                [class.bi-eye-slash]="showConfirmPassword"></i>
                        </button>
                    </div>
                    <div *ngIf="submitted && (confirmPasswordControl.errors?.['required'] || commonForm.errors?.['passwordMismatch'])"
                        class="invalid-feedback d-block mt-1">
                        <span *ngIf="confirmPasswordControl.errors?.['required']">
                            <i class="bi bi-x-circle me-1"></i>Please confirm your password
                        </span>
                        <span *ngIf="commonForm.errors?.['passwordMismatch']">
                            <i class="bi bi-x-circle me-1"></i>Passwords do not match
                        </span>
                    </div>
                </div>

                <!-- Company Name for Employer -->
                <div *ngIf="selectedRole === UserRole.EMPLOYER" [formGroup]="employerForm" class="mb-3">
                    <label for="companyName" class="form-label fw-medium">Company Name</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">
                            <i class="bi bi-building text-muted"></i>
                        </span>
                        <input type="text" id="companyName" formControlName="companyName" class="form-control"
                            [class.is-invalid]="submitted && companyNameControl.invalid"
                            placeholder="Enter your company name">
                    </div>
                    <div *ngIf="submitted && companyNameControl.invalid" class="invalid-feedback d-block mt-1">
                        <span *ngIf="companyNameControl.errors?.['required']">
                            <i class="bi bi-x-circle me-1"></i>Company name is required
                        </span>
                        <span *ngIf="companyNameControl.errors?.['minlength']">
                            <i class="bi bi-x-circle me-1"></i>Company name must be at least 2 characters
                        </span>
                    </div>
                </div>


                <!-- Terms Agreement -->
                <div class="mb-4">
                    <div class="form-check">
                        <input type="checkbox" id="agreeToTerms" formControlName="agreeToTerms" class="form-check-input"
                            [class.is-invalid]="submitted && agreeToTermsControl.invalid">
                        <label for="agreeToTerms" class="form-check-label small">
                            I agree to the
                            <a href="#" class="text-decoration-none">Terms of Service</a>
                            and
                            <a href="#" class="text-decoration-none">Privacy Policy</a>
                        </label>
                        <div *ngIf="submitted && agreeToTermsControl.errors?.['requiredTrue']"
                            class="invalid-feedback d-block">
                            <i class="bi bi-x-circle me-1"></i>You must agree to the terms and conditions
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-lg w-100 mt-2"
                    [disabled]="loading || (selectedRole === UserRole.EMPLOYER && employerForm.invalid) || commonForm.invalid">
                    <span *ngIf="!loading">
                        <i class="bi bi-person-plus me-2"></i>Create Account
                    </span>
                    <span *ngIf="loading">
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        Creating Account...
                    </span>
                </button>
            </form>

            <!-- Already have account -->
            <div class="text-center mt-4">
                <p class="text-muted small">
                    Already have an account?
                    <a (click)="navigateToLogin()"
                        class="text-decoration-none fw-medium text-primary ms-1 cursor-pointer">
                        Sign in here
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>
<auth-footer></auth-footer>