<!-- features/employer/employer-dashboard/employer-dashboard.component.html -->
<div class="container-fluid employer-dashboard-container">
  <!-- Dashboard Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
        <div class="mb-3 mb-md-0">
          <h1 class="h2 mb-2 text-dark">Employer Dashboard</h1>
          <p class="text-muted mb-0">Welcome back, {{currentUser?.fullName}}! Here's what's happening with your jobs.
          </p>
        </div>
        <!-- Added Manage Jobs Button -->
        <button routerLink="/employer/manage-jobs" class="btn btn-primary manage-jobs-btn">
          <i class="bi bi-list-task me-2"></i>
          Manage Jobs
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <ng-container *ngIf="loadingDashboard && loadingJobs && loadingApplications">
    <div class="row mb-4">
      <div class="col-12">
        <div class="row g-3">
          <div class="col-6 col-md-3" *ngFor="let i of [1,2,3,4]">
            <div class="card h-100 animate-pulse">
              <div class="card-body">
                <div class="placeholder-glow">
                  <div class="placeholder col-8 mb-3 bg-secondary"></div>
                  <div class="placeholder col-4 bg-secondary"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Quick Stats -->
  <div class="row mb-4 stats-grid" *ngIf="!loadingDashboard">
    <div class="col-6 col-md-3 mb-3" *ngFor="let stat of [
      { label: 'Active Jobs', value: totalStats.activeJobs, icon: 'bi-briefcase', color: 'blue' },
      { label: 'Total Applications', value: totalStats.totalApplications, icon: 'bi-file-text', color: 'green' },
      { label: 'Interviews', value: totalStats.interviewsScheduled, icon: 'bi-calendar-event', color: 'purple' },
      { label: 'Profile Views', value: dashboardData?.profileViews || 0, icon: 'bi-eye', color: 'yellow' }
    ]">
      <div class="stat-card h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-subtitle text-muted mb-1">{{stat.label}}</h6>
            <h3 class="card-title mb-0">{{stat.value}}</h3>
          </div>
          <div class="stat-icon-wrapper" [ngClass]="stat.color">
            <i class="bi {{stat.icon}} fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="row mb-4" *ngIf="!loadingDashboard">
    <div class="col-lg-6 mb-4 mb-lg-0">
      <div class="chart-container h-100">
        <h3 class="chart-title">Applications by Status</h3>
        <div class="chart-wrapper">
          <canvas baseChart [data]="applicationsChartData" [options]="chartOptions" type="pie">
          </canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-6" *ngIf="viewsChartData">
      <div class="chart-container h-100">
        <h3 class="chart-title">Top Jobs Performance</h3>
        <div class="chart-wrapper">
          <canvas baseChart [data]="viewsChartData" [options]="chartOptions" type="bar">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Jobs & Applications -->
  <div class="row mb-4">
    <!-- Recent Jobs -->
    <div class="col-lg-6 mb-4 mb-lg-0">
      <div class="recent-card h-100">
        <div class="card-header">
          <h3 class="card-title mb-0">Recent Jobs</h3>
        </div>
        <div class="card-body p-0">
          <ng-container *ngIf="!loadingJobs && recentJobs.length > 0; else noJobs">

            <div *ngFor="let job of recentJobs" class="item-row" (click)="job.id && navigateToJob(job.id)">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h5 class="mb-1">{{job.title}}</h5>
                  <p class="text-muted small mb-2">{{job.company.name}}</p>
                  <div class="d-flex gap-2">
                    <span class="badge badge-blue">{{job.jobType}}</span>
                    <span class="badge badge-green">{{job.experienceLevel}}</span>
                  </div>
                </div>
                <div class="text-end">
                  <div class="text-muted small">{{job.applicantsCount || 0}} applicants</div>
                  <div class="text-muted small">{{job.viewsCount || 0}} views</div>
                </div>
              </div>
            </div>
          </ng-container>
          <ng-template #noJobs>
            <div class="empty-state">
              <div class="empty-icon">
                <i class="bi bi-briefcase"></i>
              </div>
              <h5 class="empty-text">No jobs posted yet</h5>
              <button routerLink="/employer/post-job" class="btn btn-primary">
                Post Your First Job
              </button>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Recent Applications -->
    <div class="col-lg-6">
      <div class="recent-card h-100">
        <div class="card-header">
          <h3 class="card-title mb-0">Recent Applications</h3>
        </div>
        <div class="card-body p-0">
          <ng-container *ngIf="!loadingApplications && recentApplications.length > 0; else noApplications">
            <div *ngFor="let application of recentApplications" class="item-row"
              (click)="application.jobId && navigateToApplicants(application.jobId)">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h5 class="mb-1">{{application.jobSeekerName || 'Applicant'}}</h5>
                  <p class="text-muted small mb-2">{{application.jobTitle || 'Job Title N/A'}}</p>
                  <p class="text-muted small mb-0">
                    Applied {{application.appliedAt | date:'mediumDate'}}
                  </p>
                </div>
                <div>
                  <span [class]="'status-badge status-' + application.status.toLowerCase()">
                    {{application.status.replace('_', ' ')}}
                  </span>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-template #noApplications>
            <div class="text-center py-4">
              <p class="text-muted">No recent applications</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- Companies Section -->
  <div class="row mb-4" *ngIf="companies.length > 0">
    <div class="col-12">
      <div class="companies-section">
        <div class="section-header">
          <h3 class="section-title">Your Companies</h3>
        </div>
        <div class="companies-grid">
          <div class="row g-3">
            <div class="col-md-4" *ngFor="let company of companies">
              <div class="company-card h-100" (click)="navigateToCompany(company.id)">
                <div class="d-flex align-items-center">
                  <div class="company-logo me-3">
                    <img *ngIf="company.logoUrl" [src]="company.logoUrl" [alt]="company.name">
                    <div *ngIf="!company.logoUrl" class="logo-placeholder">
                      <i class="bi bi-building"></i>
                    </div>
                  </div>
                  <div>
                    <h6 class="mb-1">{{company.name}}</h6>
                    <p class="text-muted small mb-1">{{company.industry}}</p>
                    <div class="d-flex align-items-center">
                      <span class="text-muted small me-2">{{company.reviewCount || 0}} reviews</span>
                      <span *ngIf="company.verified" class="verified-badge">
                        Verified
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row quick-actions">
    <div class="col-md-4 mb-3" *ngFor="let action of [
      { route: '/employer/post-job', icon: 'bi-plus-circle', color: 'blue', title: 'Post a Job', desc: 'Create a new job listing' },
      { route: '/employer/manage-jobs', icon: 'bi-list-task', color: 'green', title: 'Manage Jobs', desc: 'View and edit all jobs' },
      { route: '/employer/company-profile/edit', icon: 'bi-building', color: 'purple', title: 'Company Profile', desc: 'Update company information' }
    ]">
      <a [routerLink]="action.route" class="action-card">
        <div class="action-icon" [ngClass]="'icon-' + action.color">
          <i class="bi {{action.icon}} fs-4"></i>
        </div>
        <h4 class="action-title">{{action.title}}</h4>
        <p class="action-description">{{action.desc}}</p>
      </a>
    </div>
  </div>
</div>